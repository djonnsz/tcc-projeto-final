{% extends "base.html" %}
{% block title %}Meu Painel{% endblock %}

{% block content %}
<div class="container" style="padding: 40px 15px;">
    <h1 style="text-align: center;">Olá, <span id="nome-usuario-painel">Usuário</span>!</h1>
    
    <p style="text-align: center; font-size: 1.2rem; margin-top: 20px;">
        Este é o seu espaço. seja bem vindo.
    </p>

    <div style="margin-top: 50px; padding: 40px; border: 2px dashed #eee; border-radius: 8px; text-align: center;">
        <h2>Teste de Avaliação</h2>
        <p></p>
        <a href="{{ url_for('questionario') }}" class="btn" style="margin-top: 20px; display: inline-block;">Iniciar Teste</a>
    </div>

    <div style="text-align: center; margin-top: 30px;">
        <a href="#" id="logoutUsuarioButton" style="color: red;">Sair (Logout)</a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- CÓDIGO ORIGINAL QUE JÁ ESTAVA AQUI ---
        const userDataString = localStorage.getItem('userData');
        
        if (userDataString) {
            const user = JSON.parse(userDataString);
            document.getElementById('nome-usuario-painel').textContent = user.nome;
        } else {
            window.location.href = '/'; 
        }

        // --- SCRIPT PARA ABRIR O CHAT (JÁ EXISTENTE) ---
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('abrir_chat')) {
            const botaoDoChat = document.getElementById('chat-label');
            if (botaoDoChat) {
                botaoDoChat.click();
            }
        }

        // =======================================================
        // ▼▼▼ LÓGICA PARA O BOTÃO SAIR ADICIONADA AQUI ▼▼▼
        // =======================================================
        const logoutButton = document.getElementById('logoutUsuarioButton');

        if (logoutButton) {
            logoutButton.addEventListener('click', function(event) {
                // Previne o comportamento padrão do link (#)
                event.preventDefault();

                // 1. Limpa os dados do usuário do navegador
                localStorage.removeItem('userData');

                // 2. Redireciona para a rota de logout do Flask que criamos
                window.location.href = "{{ url_for('logout') }}";
            });
        }
    });
</script>
{% endblock %}